<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Study Agent</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <h2>ğŸ“˜ Study Agent</h2>

    <!-- ä¸€èˆ¬èŠå¤© -->
    <textarea id="input" rows="4"
      placeholder="Ask a study question..."></textarea>
    <br>
    <button onclick="send()">Ask</button>

    <hr>

    <!-- PDF Assistant -->
    <h3>ğŸ“„ PDF Study Assistant</h3>

    <input type="file" id="pdfFile" accept=".pdf"><br><br>

    <label>åŠŸèƒ½ï¼š</label>
    <select id="task">
      <option value="summary">æ‘˜è¦</option>
      <option value="quiz">å‡ºè€ƒé¡Œ</option>
    </select>

    <label>æ‘˜è¦æ¨¡å¼ï¼š</label>
    <select id="mode">
      <option value="overall">å…¨æ–‡é‡é»</option>
      <option value="per_page">æ¯é é‡é»</option>
    </select>

    <label>è€ƒé¡Œé¡å‹ï¼š</label>
    <select id="quiz">
      <option value="mixed">æ··åˆ</option>
      <option value="mcq">å–®é¸é¡Œ</option>
      <option value="qa">å•ç­”é¡Œ</option>
    </select>

    <br><br>
    <button onclick="sendPDF()">Analyze PDF</button>

    <hr>

    <pre id="output"></pre>
  </div>

<script>
async function send() {
  const msg = document.getElementById("input").value;
  const output = document.getElementById("output");
  output.textContent = "Thinking...";

  const res = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: msg })
  });

  const data = await res.json();

  output.textContent =
    data.message?.content ||
    data.choices?.[0]?.message?.content ||
    JSON.stringify(data, null, 2);
}


async function sendPDF() {
  const file = document.getElementById("pdfFile").files[0];
  const task = document.getElementById("task").value;
  const mode = document.getElementById("mode").value;
  const quiz = document.getElementById("quiz").value;
  const output = document.getElementById("output");

  if (!file) {
    alert("è«‹ä¸Šå‚³ PDF");
    return;
  }

  const formData = new FormData();
  formData.append("pdf", file);
  formData.append("task", task);
  formData.append("mode", mode);
  formData.append("quiz", quiz);

  output.textContent = "ğŸ“– Analyzing PDF...";

  const res = await fetch("/pdf_chat", {
    method: "POST",
    body: formData
  });

  const data = await res.json();

  if (data.error) {
    output.textContent = "Error: " + data.error;
    return;
  }

  output.textContent =
    `ğŸ“„ PDF Pages: ${data.pages}\n\n` +
    (data.result.message?.content ||
     data.result.choices?.[0]?.message?.content ||
     JSON.stringify(data, null, 2));
}
</script>
</body>
</html>



