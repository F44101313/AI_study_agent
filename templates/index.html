<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Study Agent</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
  <h2>ğŸ“˜ Study Agent</h2>

  <button onclick="newChat()">ğŸ†• æ–°å°è©±</button>

  <hr>

  <!-- å°è©±ç´€éŒ„æ¡† -->
  <textarea id="chatLog" rows="15" readonly placeholder="å°è©±ç´€éŒ„..."></textarea><br>

  <!-- è¼¸å…¥æ¡† -->
  <textarea id="chatInput" rows="4" placeholder="åœ¨æ­¤è¼¸å…¥è¨Šæ¯..."></textarea><br>
  <button onclick="send()">é€å‡º</button>

  <hr>

  <h3>ğŸ“„ PDF Study Assistant</h3>

  <input type="file" id="pdfFile" accept=".pdf"><br><br>

  <label>åŠŸèƒ½ï¼š</label>
  <select id="task">
    <option value="summary">æ‘˜è¦</option>
    <option value="quiz">å‡ºè€ƒé¡Œ</option>
  </select>

  <label>è€ƒé¡Œé¡å‹ï¼š</label>
  <select id="quiz">
    <option value="mixed">æ··åˆ</option>
    <option value="mcq">å–®é¸é¡Œ</option>
    <option value="qa">å•ç­”é¡Œ</option>
  </select>

  <br><br>
  <button onclick="sendPDF()">åˆ†æ PDF</button>
</div>

<script>
const chatLog = document.getElementById("chatLog");
const chatInput = document.getElementById("chatInput");

async function newChat() {
  await fetch("/reset", { method: "POST" });
  chatLog.value = "âœ¨ æ–°å°è©±é–‹å§‹\n";
  chatInput.value = "";
}

async function send() {
  const msg = chatInput.value.trim();

  if (!msg) return;

  chatLog.value += `\nğŸ§‘ ${msg}\n`;
  chatInput.value = ""; // æ¸…ç©ºè¼¸å…¥æ¡†

  const res = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: msg })
  });

  const data = await res.json();
  chatLog.value += `ğŸ¤– ${data.reply}\n`;

  // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
  chatLog.scrollTop = chatLog.scrollHeight;
}

async function sendPDF() {
  const file = document.getElementById("pdfFile").files[0];
  const task = document.getElementById("task").value;
  const quiz = document.getElementById("quiz").value;

  if (!file) {
    alert("è«‹ä¸Šå‚³ PDF");
    return;
  }

  const formData = new FormData();
  formData.append("pdf", file);
  formData.append("task", task);
  formData.append("quiz", quiz);

  chatLog.value += "\nğŸ“– åˆ†æ PDF ä¸­...\n";

  const res = await fetch("/pdf_chat", { method: "POST", body: formData });
  const data = await res.json();
  chatLog.value += `ğŸ¤– ${data.reply}\n`;

  chatLog.scrollTop = chatLog.scrollHeight;
}
</script>
</body>
</html>
